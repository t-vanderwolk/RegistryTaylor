generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id               String            @id @default(uuid())
  email            String            @unique
  passwordHash     String
  role             UserRole          @default(MEMBER)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  profile          Profile?          @relation("UserProfile")
  mentorOf         Profile[]         @relation("ProfileMentor")
  questionnaire    Questionnaire?    @relation("UserQuestionnaire")
  academyProgress  AcademyProgress[] @relation("UserProgress")
  quizzes          Quiz[]            @relation("UserQuizzes")
  workbookEntries  WorkbookEntry[]   @relation("UserWorkbookEntries")
  announcements    Announcement[]    @relation("UserAnnouncements")
  comments         Comment[]         @relation("UserComments")
  communityPosts   CommunityPost[]   @relation("UserCommunityPosts")
  messagesSent     Message[]         @relation("SentMessages")
  messagesReceived Message[]         @relation("ReceivedMessages")
  eventsCreated    Event[]           @relation("EventCreators")
  eventRsvps       EventRsvp[]       @relation("UserEventRsvps")
  pinterestBoards  PinterestBoard[]
}

model Profile {
  id                String   @id @default(uuid())
  userId            String   @unique
  mentorId          String?
  conciergePriority Int?
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation("UserProfile", fields: [userId], references: [id], onDelete: Cascade)
  mentor            User?    @relation("ProfileMentor", fields: [mentorId], references: [id])

  @@index([mentorId])
}

model Questionnaire {
  id            String    @id @default(uuid())
  userId        String    @unique
  dueDate       DateTime?
  availability  String?
  birthLocation String?
  supportNeeds  String?
  preferences   Json?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  user          User      @relation("UserQuestionnaire", fields: [userId], references: [id], onDelete: Cascade)
}

model AcademyModule {
  id              String            @id @default(uuid())
  slug            String            @unique
  title           String
  subtitle        String?
  summary         String?
  content         Json?
  category        String?
  lecture         String?
  workbookPrompt  String?
  order           Int?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  progress        AcademyProgress[] @relation("ModuleProgress")
  quizzes         Quiz[]            @relation("ModuleQuizzes")
  workbookEntries WorkbookEntry[]   @relation("ModuleWorkbookEntries")
}

model AcademyProgress {
  id         String        @id @default(uuid())
  userId     String
  moduleId   String
  percent    Int           @default(0)
  completed  Boolean       @default(false)
  quizScore  Int?
  reflection String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  module     AcademyModule @relation("ModuleProgress", fields: [moduleId], references: [id], onDelete: Cascade)
  user       User          @relation("UserProgress", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, moduleId])
}

model Quiz {
  id        Int           @id @default(autoincrement())
  moduleId  String
  userId    String?
  question  String
  options   String[]
  answer    String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  module    AcademyModule @relation("ModuleQuizzes", fields: [moduleId], references: [id], onDelete: Cascade)
  user      User?         @relation("UserQuizzes", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([moduleId, question])
  @@index([moduleId])
  @@index([userId])
}

model CommunityPost {
  id        String    @id @default(uuid())
  authorId  String
  title     String
  body      String
  tags      String[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  author    User      @relation("UserCommunityPosts", fields: [authorId], references: [id], onDelete: Cascade)
  comments  Comment[]
}

model Comment {
  id        String        @id @default(uuid())
  postId    String
  authorId  String
  body      String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  post      CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  author    User          @relation("UserComments", fields: [authorId], references: [id], onDelete: Cascade)

  @@index([postId])
}

model Event {
  id          String      @id @default(uuid())
  createdById String
  title       String
  description String?
  startsAt    DateTime
  endsAt      DateTime?
  location    String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  createdBy   User        @relation("EventCreators", fields: [createdById], references: [id], onDelete: Cascade)
  rsvps       EventRsvp[]
}

model EventRsvp {
  id        String     @id @default(uuid())
  eventId   String
  userId    String
  status    RsvpStatus @default(GOING)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  event     Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User       @relation("UserEventRsvps", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
}

model BlogPost {
  id          String   @id @default(uuid())
  slug        String   @unique
  title       String
  excerpt     String?
  body        String
  publishedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model WorkbookEntry {
  id         String        @id @default(uuid())
  memberId   String
  moduleSlug String
  content    Json
  shared     Boolean       @default(false)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  member     User          @relation("UserWorkbookEntries", fields: [memberId], references: [id], onDelete: Cascade)
  module     AcademyModule @relation("ModuleWorkbookEntries", fields: [moduleSlug], references: [slug], onDelete: Cascade)

  @@unique([memberId, moduleSlug])
}

model Announcement {
  id        String   @id @default(uuid())
  authorId  String
  title     String
  body      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  author    User     @relation("UserAnnouncements", fields: [authorId], references: [id], onDelete: Cascade)
}

model Poll {
  id        String       @id @default(uuid())
  question  String
  category  String
  isActive  Boolean      @default(true)
  closesAt  DateTime?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  options   PollOption[]
}

model PollOption {
  id     String @id @default(uuid())
  pollId String
  label  String
  votes  Int    @default(0)
  order  Int    @default(0)
  poll   Poll   @relation(fields: [pollId], references: [id], onDelete: Cascade)

  @@index([pollId])
}

model Message {
  id         String   @id @default(cuid())
  senderId   String
  receiverId String
  content    String
  createdAt  DateTime @default(now())
  read       Boolean  @default(false)
  sender     User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
}

model PinterestBoard {
  id           String   @id @default(uuid())
  userId       String
  title        String
  visibility   String   @default("private")
  pinterestUrl String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum UserRole {
  MEMBER
  MENTOR
  ADMIN
}

enum InviteStatus {
  PENDING
  ACCEPTED
  REVOKED
}

enum RsvpStatus {
  GOING
  INTERESTED
  DECLINED
}

model Invite {
  id          String       @id @default(uuid())
  email       String
  role        UserRole     @default(MEMBER)
  code        String       @unique
  permissions String[]
  status      InviteStatus @default(PENDING)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}
